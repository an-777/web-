<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>翻譯段落比對工具</title>
  <style>
    body {
      display: flex;
      margin: 0;
      font-family: sans-serif;
    }
    .column {
      flex: 1;
      padding: 20px;
      overflow-y: scroll;
      height: 100vh;
      border-right: 1px solid #ccc;
    }
    .column:last-child {
      border-right: none;
    }
    .paragraph {
      margin-bottom: 16px;
      white-space: pre-wrap;
      transition: background-color 0.2s ease;
    }
    .paragraph:hover {
      background-color: #f0f8ff;
      cursor: pointer;
    }
    .highlight {
      background-color: #ffeeba;
    }
  </style>
</head>
<body>
  <div class="column" id="original"></div>
  <div class="column" id="translated"></div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    async function loadAndRenderMarkdown(url, containerId, storageArray) {
      const res = await fetch(url);
      const text = await res.text();

      const paragraphs = text.split(/\n\s*\n/); // 以空行分段
      const container = document.getElementById(containerId);
      container.innerHTML = "";

      paragraphs.forEach((paragraph, index) => {
        const div = document.createElement('div');
        div.className = 'paragraph';
        div.innerHTML = marked.parse(paragraph.trim());
        div.dataset.index = index;
        storageArray.push(div);
        container.appendChild(div);
      });
    }

    const originalParagraphs = [];
    const translatedParagraphs = [];

    // 載入內容
    Promise.all([
      loadAndRenderMarkdown('1.md', 'original', originalParagraphs),
      loadAndRenderMarkdown('2.md', 'translated', translatedParagraphs)
    ]).then(() => {
      // 加入事件綁定
      const total = Math.min(originalParagraphs.length, translatedParagraphs.length);

      for (let i = 0; i < total; i++) {
        const orig = originalParagraphs[i];
        const trans = translatedParagraphs[i];

        function highlightPair() {
          removeHighlights();
          orig.classList.add('highlight');
          trans.classList.add('highlight');
        }

        function removeHighlights() {
          document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
        }

        orig.addEventListener('mouseenter', highlightPair);
        trans.addEventListener('mouseenter', highlightPair);

        orig.addEventListener('mouseleave', removeHighlights);
        trans.addEventListener('mouseleave', removeHighlights);

        orig.addEventListener('click', highlightPair);
        trans.addEventListener('click', highlightPair);
      }
    });
  </script>
</body>
</html>